$("#loadurl").click(function(){
    chrome.tabs.getSelected(null, function(tab){
        $("#url").val(tab.url);
    });
});

// 处理cookie
function parseCookie(cookieString){
    var cookieList = cookieString.split(";")
    var cookie = {};

    for(var i in cookieList){
        var cookieKey = cookieList[i].split("=")[0].replace(" ", "");
        var cookieValue = cookieList[i].split("=")[1];

        cookie[cookieKey] = cookieValue;
    }
    return cookie;
}

function executeModifyHeaders(details){
    var ua = $("#ua_form input").val();
    var headers = details.requestHeaders;
    var ua = $("#ua_form input").val();

    if(details.url){
        for(var index in headers){
            if(ua != "" && headers[index].name == 'User-Agent'){
                headers[index].value = ua;a
            }
            // if(cookie != ""){
            //     cookie = parseCookie(cookie);
            //     cookie["url"] = regx_url;

            //     chrome.cookies.set(cookie, function(c){});
            // }
        }
        return {requestHeaders: headers}
    }

}

$("#execute").click(function(){
    var target = $("#url").val();
    var cookie = $("#cookie_form input").val();
    var regx_url = /(http[s]?:\/\/.*?)\//.exec(target)[0];

    chrome.webRequest.onBeforeSendHeaders.addListener(executeModifyHeaders, {urls: ["<all_urls>"], tabId: chrome.devtools.inspectedWindow.tabId}, ["blocking", "requestHeaders"]);

    chrome.tabs.update(null, {
            url: target
        }, function(){
            // chrome.webRequest.onBeforeSendHeaders.removeListener(executeModifyHeaders);
        });

});



// 编码解码
$("#urlencode").click(function(){
    var content = $("#url").val();
    $("#url").val(encodeURIComponent(content));
});

$("#urldecode").click(function(){
    var content = $("#url").val();
    $("#url").val(decodeURIComponent(content));
});

$("#b64encode").click(function(){
    var content = $("#url").val();
    $("#url").val(btoa(content));
});

$("#b64decode").click(function(){
    var content = $("#url").val();
    $("#url").val(atob(content));
});


// 设置cookie和ua
$("#enable_ua").click(function() {
    if($(this).is(":checked")){
        $("#ua_form").show();
    }else{
        $("#ua_form").hide();
    }
});

$("#enable_cookie").click(function() {
    if($(this).is(":checked")){
        $("#cookie_form").show();
    }else{
        $("#cookie_form").hide();
    }
});